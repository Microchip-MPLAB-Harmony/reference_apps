<p><img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png" alt="Microchip logo">
<img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_mplab_harmony_logo_small.png" alt="Harmony logo small"></p>
<h1 id="xdmac-with-qspi-application-on-sam-e70-xplained-ultra-evaluation-kit">XDMAC with QSPI Application on SAM E70 Xplained Ultra Evaluation Kit</h1>
<hr>
<h2 id="description-">Description:</h2>
<blockquote>
<p>This application demonstrates the usage of Extended Direct Memory Access Controller (XDMAC) with QSPI on Cortex-M7 based MCU (SAM E70).
  The application writes and reads 80KB data into the External Serial Flash memory using the QSPI, with and without using XDMAC.</p>
</blockquote>
<h2 id="modules-technology-used-">Modules/Technology Used:</h2>
<ul>
<li>Peripheral Modules<ul>
<li>EFC</li>
<li>MPU</li>
<li>QSPI</li>
<li>XDMAC</li>
<li>SYSTICK</li>
</ul>
</li>
</ul>
<h2 id="hardware-used-">Hardware Used:</h2>
<ul>
<li><a href="https://www.microchip.com/Developmenttools/ProductDetails/DM320113">SAM E70 Xplained Ultra Evaluation Kit</a> </li>
<li>Logic Analyzer or Oscilloscope  </li>
</ul>
<h2 id="software-tools-used-">Software/Tools Used:</h2>
<p><span style="color:blue"> <em>This project has been verified to work with the following versions of software tools:</em></span>  </p>
<ul>
<li><a href="https://github.com/Microchip-MPLAB-Harmony/csp/releases/tag/v3.6.1">MPLAB Harmony v3 &quot;csp&quot; repo v3.6.1</a></li>
<li><a href="https://github.com/Microchip-MPLAB-Harmony/dev_packs/releases/tag/v3.6.1">MPLAB Harmony v3 &quot;dev_packs&quot; repo v3.6.1</a></li>
<li><a href="https://github.com/Microchip-MPLAB-Harmony/mhc/releases/tag/v3.3.5">MPLAB Harmony v3 &quot;mhc&quot; repo v3.3.5</a></li>
<li>MPLAB Harmony Configurator Plugin v3.4.2 </li>
<li><a href="https://www.microchip.com/mplab/mplab-x-ide">MPLAB X IDE v5.35</a></li>
<li><a href="https://www.microchip.com/mplab/compilers">MPLAB XC32 Compiler v2.40</a></li>
<li><a href="https://www.microchip.com/mplab/mplab-integrated-programming-environment">MPLAB X IPE v5.35</a></li>
<li>Any Serial Terminal application like Tera Term terminal application.<br><span style="color:blue"> <em>Because Microchip regularly update tools, occasionally issue(s) could be discovered while using the newer versions of the tools. If the project doesnâ€™t seem to work and version incompatibility is suspected, It is recommend to double-check and use the same versions that the project was tested with.</em> </span></li>
</ul>
<h2 id="setup-">Setup:</h2>
<ul>
<li>Connect the micro USB to the Host computer</li>
<li>Connect the Saleae Logic Analyzer and establish a connection with the Host PC</li>
<li>Configure the four channels to measure the QSPI throughput as follows<ul>
<li>Channel 0 is PA19, which is configured to Set and Clear the pin before and after the QSPI Write without DMA</li>
<li>Channel 1 is PB2, which is configured to Set and Clear the pin before and after the QSPI Read without DMA</li>
<li>Channel 2 is PC31, which is configured to Set and Clear the pin before and after the QSPI Write with DMA</li>
<li>Channel 3 is PB3, which is configured to Set and Clear the pin before and after the QSPI Read with DMA</li>
</ul>
</li>
<li><img src = "images/hardware_setup.png" width="725" height="515" align="middle"></li>
</ul>
<h2 id="programming-binary-hex-file-">Programming binary/hex file:</h2>
<ul>
<li>If you are not interested in installing development tools. The pre-built binary/hex file can be programmed to the target<h3 id="steps-to-program-the-hex-file-using-mplab-x-ipe">Steps to program the hex file using MPLAB X IPE</h3>
<ul>
<li>Open MPLAB X IPE</li>
<li>Select Device has &quot;ATSAME70Q21B&quot;</li>
<li>Power the SAM E70 Xplained Ultra Evaluation Kit from a Host PC through a Type-A male to Micro-B USB cable connected to Micro-B port</li>
<li>Once Power cable is connected, &quot;EDBG&quot; hardware tool is identified as a programmer</li>
<li>Browse to hex file (qspi_xdmac_read_write_hex_file.hex)</li>
<li>Click on program button. The device gets programmed in sometime</li>
<li>Follow the steps in &quot;Running the Demo&quot; section below</li>
</ul>
</li>
</ul>
<h2 id="programming-debugging-application-project-">Programming/Debugging Application Project:</h2>
<ul>
<li>Open the project (qspi_xdmac_read_write_hex_file\firmware\sam_e70_xult.X) in MPLAB X IDE</li>
<li>Ensure &quot;EDBG&quot; is selected as hardware tool to program/debug the application</li>
<li>Build the code and program the device by clicking on the &quot;make and program&quot; button in MPLAB X IDE tool bar</li>
<li>Follow the steps in &quot;Running the Demo&quot; section below</li>
</ul>
<h2 id="running-the-demo-">Running the Demo:</h2>
<ul>
<li>Start capturing samples using the Logic Analyzer Software</li>
<li>Reset the hardware to start the application run from the beginning</li>
<li>Stop capturing the sample in the Logic Analyzer Software</li>
<li>Verify the the above mentioned four GPIO Pin waveforms and timestamps to see the QSPI performance with and without using the XDMAC for the following cases<ul>
<li>Write 80KB of data to external serial Flash without using the DMA</li>
<li>Read 80KB of data from the external serial Flash without using the DMA</li>
<li>Write 80KB of data to external serial Flash using the DMA</li>
<li>Read 80KB of data from the external serial Flash using the DMA</li>
<li><img src = "images/waveform_overview.png" width="710" height="240" align="middle"></li>
</ul>
</li>
</ul>
<h2 id="comments-">Comments:</h2>
<ul>
<li>Reference Application Note: <a href="TBD">Using XDMAC with QSPI on CORTEX-M7 MCUs Using MPLAB Harmony v3</a></li>
<li>Getting Started Training Module: <a href="https://microchipdeveloper.com/harmony3:same70-getting-started-training-module">Getting Started with Harmony v3 Peripheral Libraries on SAM E70 MCUs</a></li>
<li>This application demo builds and works out of box by following the instructions above in &quot;Running the Demo&quot; section. If you need to enhance/customize this application demo, you need to use the MPLAB Harmony v3 Software framework. Refer links below to setup and build your applications using MPLAB Harmony<ul>
<li><a href="https://www.microchip.com/mymicrochip/filehandler.aspx?ddocname=en1000821">How to Setup MPLAB Harmony v3 Software Development Framework</a> </li>
<li><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/How_to_Build_Application_Adding_PLIB_%20Driver_or_Middleware%20_to_MPLAB_Harmony_v3Project_DS90003253A.pdf">How to Build an Application by Adding a New PLIB, Driver, or Middleware to an Existing MPLAB Harmony v3 Project</a>  </li>
</ul>
</li>
<li>The application is available on MPLAB Harmony v3 GitHub repository <a href="https://github.com/Microchip-MPLAB-Harmony/reference_apps/tree/master/apps/sam_e70_xult/qspi_xdmac_read_write">reference_apps</a>    </li>
</ul>
<h2 id="revision-">Revision:</h2>
<ul>
<li>v1.0 released demo application</li>
</ul>
