<p><img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png" alt="Microchip logo">
<img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_mplab_harmony_logo_small.png" alt="Harmony logo small"></p>
<h1 id="sleepwalking-application-demo-on-sam-e54-xplained-pro-evaluation-kit">SleepWalking Application Demo on SAM E54 Xplained Pro Evaluation Kit</h1>
<hr>
<h2 id="description-">Description:</h2>
<blockquote>
<p>This application demonstrates SleepWalking using the Event System. The application uses an ADC with a Window Monitoring feature in Standby mode for the following use
cases:  </p>
<ul>
<li>Standby mode with Interrupts (IRQ)  </li>
<li>Standby mode with Event System (SleepWalking)<br>On power up, the application is in STDBY_IRQ_MODE. It is possible to switch from STDBY_IRQ_MODE to
STDBY_EVSYS_MODE by pressing the switch button (SW0) embedded on the SAM E54 Xplained Pro board. The
application wakes up from Sleep mode and enters into ACTIVE_MODE when the embedded light sensor on the I/O1
Xplained Pro extension kit is covered.</li>
</ul>
</blockquote>
<h2 id="modules-technology-used-">Modules/Technology Used:</h2>
<ul>
<li>Peripheral Modules<ul>
<li>ADC</li>
<li>CMCC</li>
<li>DMAC</li>
<li>EVSYS</li>
<li>NVMCTRL</li>
<li>PM</li>
<li>RTC</li>
<li>SERCOM</li>
<li>SUPC</li>
<li>SYSTICK</li>
</ul>
</li>
<li>STDIO Library</li>
</ul>
<h2 id="hardware-used-">Hardware Used:</h2>
<ul>
<li><a href="https://www.microchip.com/developmenttools/ProductDetails/atsame54-xpro">SAM E54 Xplained Pro Evaluation Kit</a>   </li>
<li><a href="https://www.microchip.com/DevelopmentTools/ProductDetails/ATIO1-XPRO">I/O1 Xplained Pro Extension Kit</a></li>
</ul>
<h2 id="software-tools-used-">Software/Tools Used:</h2>
<p><span style="color:blue"> <em>This project has been verified to work with the following versions of software tools:</em></span>  </p>
<ul>
<li><a href="https://github.com/Microchip-MPLAB-Harmony/csp/releases/tag/v3.5.0">MPLAB Harmony v3 &quot;csp&quot; repo v3.5.0</a></li>
<li><a href="https://github.com/Microchip-MPLAB-Harmony/dev_packs/releases/tag/v3.5.0">MPLAB Harmony v3 &quot;dev_packs&quot; repo v3.5.0</a>  </li>
<li><a href="https://github.com/Microchip-MPLAB-Harmony/mhc/releases/tag/v3.3.3">MPLAB Harmony v3 &quot;mhc&quot; repo v3.3.2</a>    </li>
<li><a href="https://www.microchip.com/mplab/mplab-x-ide">MPLAB X IDE v5.25</a></li>
<li><a href="https://www.microchip.com/mplab/compilers">MPLAB XC32 Compiler v2.30</a></li>
<li><a href="https://www.microchip.com/mplab/mplab-integrated-programming-environment">MPLAB X IPE v5.25</a></li>
<li><a href="https://www.microchip.com/mplab/avr-support/data-visualizer">Standalone Data Visualizer</a></li>
<li>Any Serial Terminal application like Tera Term terminal application
<span style="color:blue"> <em>Because Microchip regularly update tools, occasionally issue(s) could be discovered while using the newer versions of the tools. If the project doesn’t seem to work and version incompatibility is suspected, It is recommend to double-check and use the same versions that the project was tested with.</em> </span></li>
</ul>
<h2 id="setup-">Setup:</h2>
<ul>
<li>Ensure jumper to measure MCU current is set to MEASUR</li>
<li>Ensure jumper to measure I/O current is set to BYPASS</li>
<li>Connect the I/O1 Xplained Pro Extension Kit to the XPRO connector 2 on the SAM E54 Xplained Pro Evaluation Kit</li>
<li>Connect the micro USB cable from the computer to the DEBUG USB connector on the SAM E54 Xplained Pro Evaluation Kit</li>
<li><img src = "images/hardware_setup.png" width="650" height="550" align="middle"></li>
</ul>
<h2 id="programming-binary-hex-file-">Programming binary/hex file:</h2>
<ul>
<li>If you are not interested in installing development tools. The pre-built binary/hex file can be programmed to the target<h3 id="steps-to-program-the-hex-file-using-mplab-x-ipe">Steps to program the hex file using MPLAB X IPE</h3>
<ul>
<li>Open MPLAB X IPE</li>
<li>Select Device has &quot;ATSAME54P20A&quot;</li>
<li>Power the SAM E54 Xplained Pro Evaluation Kit from a Host PC through a Type-A male to Micro-B USB cable connected to Micro-B port</li>
<li>Once Power cable is connected, &quot;EDBG&quot; hardware tool is identified as a programmer</li>
<li>Browse to hex file (sleepwalking_hex_file.hex)</li>
<li>Click on program button. The device gets programmed in sometime</li>
<li>Follow the steps in &quot;Running the Demo&quot; section below</li>
</ul>
</li>
</ul>
<h2 id="programming-debugging-application-project-">Programming/Debugging Application Project:</h2>
<ul>
<li>Open the project (sleepwalking\firmware\sam_e54_xpro.X) in MPLAB X IDE</li>
<li>Ensure &quot;EDBG&quot; is selected as hardware tool to program/debug the application</li>
<li>Build the code and program the device by clicking on the &quot;make and program&quot; button in MPLAB X IDE tool bar</li>
<li>Follow the steps in &quot;Running the Demo&quot; section below</li>
</ul>
<h2 id="running-the-demo-">Running the Demo:</h2>
<ul>
<li>Open Tera Term or any equivalent serial communication tool</li>
<li>In the Tera Term: New Connection window, select the Serial Port number allocated to the connected SAM E54</li>
<li>Configure the Tera Term Serial port interface to 115200 speed</li>
<li>Reset the board by pressing the reset button. The application will start by displaying the following message on the serial terminal.</li>
<li><img src = "images/sleepwalking_start.png" width="600" height="260" align="middle"></li>
<li>Open the standalone Data Visualizer tool</li>
<li>In the Data Visualizer window, select SAM E54 Xplained Pro, and then click Connect</li>
<li><img src = "images/data_visualizer1.png" width="600" height="200" align="middle"></li>
<li>Once the protocols are displayed, select the protocol Power and then click Start</li>
<li><img src = "images/data_visualizer2.png" width="600" height="275" align="middle"></li>
<li>The Data Visualizer will display the power consumption details in the Power Analysis window</li>
<li><img src = "images/data_visualizer3.png" width="600" height="265" align="middle"></li>
<li>When the application starts, the device will run on Standby with IRQ mode. The data analyzer shows the power consumption of the device when the CPU is woken up every 10 milliseconds by an RTC Compare ‘0’ interrupt to start an ADC conversion</li>
<li>Using the SW0 push button, it is possible to change the application mode from Standby with IRQ to SleepWalking. In this mode the CPU is woken up only when an ADC window monitoring interrupt occurs. The data analyzer shows the power consumption of the device when running in Standby with the Event System (SleepWalking)</li>
</ul>
<h2 id="comments-">Comments:</h2>
<ul>
<li>Reference Application Note: <a href="http://ww1.microchip.com/downloads/en/Appnotes/SleepWalking_%20with_%20Event_%20System_Using%20_%20SAME54_AN_DS00003342A.pdf">SleepWalking with Event System Using the SAM E54</a></li>
<li>Getting Started Training Module: <a href="https://microchipdeveloper.com/harmony3:same54-getting-started-training-module">Getting Started with Harmony v3 Peripheral Libraries on SAM D5x/E5x MCUs</a>      </li>
<li>This application demo builds and works out of box by following the instructions above in &quot;Running the Demo&quot; section. If you need to enhance/customize this application demo, you need to use the MPLAB Harmony v3 Software framework. Refer links below to setup and build your applications using MPLAB Harmony<ul>
<li><a href="https://www.microchip.com/mymicrochip/filehandler.aspx?ddocname=en1000821">How to Setup MPLAB Harmony v3 Software Development Framework</a> </li>
<li><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/How_to_Build_Application_Adding_PLIB_%20Driver_or_Middleware%20_to_MPLAB_Harmony_v3Project_DS90003253A.pdf">How to Build an Application by Adding a New PLIB, Driver, or Middleware to an Existing MPLAB Harmony v3 Project</a></li>
</ul>
</li>
<li>The application is available on MPLAB Harmony v3 GitHub repository <a href="https://github.com/Microchip-MPLAB-Harmony/reference_apps/tree/master/apps/sam_e54_xpro/sleepwalking">reference_apps</a></li>
</ul>
<h2 id="revision-">Revision:</h2>
<ul>
<li>v1.0 released demo application</li>
</ul>
